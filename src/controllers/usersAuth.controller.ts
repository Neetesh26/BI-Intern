import asyncWrapper from "../middleware/asyncWrapper";
import { Request, Response } from "express";
import { loginUser, registerUser, verifyUserOTP } from "../services/auth.service";
import { HttpMessage, HttpStatus } from "../constants";

export const signupUser = asyncWrapper(async (req: Request, res: Response) => {
  const { phone } = req.body as { phone: string };

  const user = await registerUser(phone);

  return res.status(HttpStatus.CREATED).json({
    message: HttpMessage.CREATED,
    data: user,
  });
});

export const verifyUserOTPController = asyncWrapper(
  async (_req: Request, _res: Response) => {
    
    console.log(_req.params);
    
    const { phone } = _req.params;
    console.log(phone);
    
    const { otp } = _req.body as { otp: string };

    const user = await verifyUserOTP(phone, otp);

    return _res.status(HttpStatus.OK).json({
      message: "OTP verified successfully",
      data: user,
    });
  }
);

export const loginUserController = asyncWrapper(
  async (req: Request, res: Response) => {

    const { phone } = req.body;
    // console.log("phone number",phone);
    
    const data = await loginUser(phone);

    return res.status(HttpStatus.OK).json({
      message: "Login successful",
      data
    });
  }
);
